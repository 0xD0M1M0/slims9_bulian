!function(t){t.fn.ajaxChosen=function(e,n,a){var i,r,o,l;return null==e&&(e={}),null==n&&(n={}),null==a&&(a=function(){}),r={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"},l=this,i=null,o=t.extend({},r,t(l).data(),e),this.chosen(a||{}),this.each(function(){return t(this).next(".chzn-container").find(".search-field > input, .chzn-search > input").bind("keyup",function(){var e,a,r,s,u;return s=t(this).val(),a=(u=t(this).val()).length<o.minTermLength?o.keepTypingMsg:o.lookingForMsg+" '"+u+"'",l.next(".chzn-container").find(".no-results").text(a),u!==t(this).data("prevVal")&&(t(this).data("prevVal",u),this.timer&&clearTimeout(this.timer),!(u.length<o.minTermLength)&&(e=t(this),null==o.data&&(o.data={}),o.data[o.jsonTermKey]=u,null!=o.dataCallback&&(o.data=o.dataCallback(o.data)),r=o.success,o.success=function(a){var i,o,u;if(null!=a)return u=[],l.find("option").each(function(){return t(this).is(":selected")?u.push(t(this).val()+"-"+t(this).text()):t(this).remove()}),l.find("optgroup:empty").each(function(){return t(this).remove()}),i=n(a),o=0,t.each(i,function(e,n){var a,i,r;return o++,n.group?((a=l.find("optgroup[label='"+n.text+"']")).size()||(a=t("<optgroup />")),a.attr("label",n.text).appendTo(l),t.each(n.items,function(e,n){var i,r;if("string"==typeof n?(r=e,i=n):(r=n.value,i=n.text),-1===t.inArray(r+"-"+i,u))return t("<option />").attr("value",r).html(i).appendTo(a)})):("string"==typeof n?(r=e,i=n):(r=n.value,i=n.text),-1===t.inArray(r+"-"+i,u)?t("<option />").attr("value",r).html(i).appendTo(l):void 0)}),o?l.trigger("liszt:updated"):(l.data().chosen.no_results_clear(),l.data().chosen.no_results(e.val())),null!=r&&r(a),e.val(s)},this.timer=setTimeout(function(){return i&&i.abort(),"application/json"===o.contentType&&(o.data=JSON.stringify(o.data)),i=t.ajax(o)},o.afterTypeDelay)))})})}}(jQuery);